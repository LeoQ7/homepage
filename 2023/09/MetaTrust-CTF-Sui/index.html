<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>2023 MetaTrust Web3 Security CTF Sui Challenges Writeup - Qi Qin</title><meta name=Description content="Writeup for 2023 MetaTrust Web3 Security CTF Sui Challenges"><meta property="og:title" content="2023 MetaTrust Web3 Security CTF Sui Challenges Writeup"><meta property="og:description" content="Writeup for 2023 MetaTrust Web3 Security CTF Sui Challenges"><meta property="og:type" content="article"><meta property="og:url" content="https://leoq7.com/2023/09/MetaTrust-CTF-Sui/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-19T17:55:28+08:00"><meta property="article:modified_time" content="2023-09-19T17:55:28+08:00"><meta property="og:site_name" content="Qi Qin"><meta name=twitter:card content="summary"><meta name=twitter:title content="2023 MetaTrust Web3 Security CTF Sui Challenges Writeup"><meta name=twitter:description content="Writeup for 2023 MetaTrust Web3 Security CTF Sui Challenges"><meta name=application-name content="Qi Qin"><meta name=apple-mobile-web-app-title content="Qi Qin"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://leoq7.com/2023/09/MetaTrust-CTF-Sui/><link rel=prev href=https://leoq7.com/2023/02/PBCTF-Move-VM/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"2023 MetaTrust Web3 Security CTF Sui Challenges Writeup","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/leoq7.com\/2023\/09\/MetaTrust-CTF-Sui\/"},"genre":"posts","keywords":"Web3, CTF, Move","wordcount":1415,"url":"https:\/\/leoq7.com\/2023\/09\/MetaTrust-CTF-Sui\/","datePublished":"2023-09-19T17:55:28+08:00","dateModified":"2023-09-19T17:55:28+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Qi Qin"},"description":"Writeup for 2023 MetaTrust Web3 Security CTF Sui Challenges"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Qi Qin">Qi Qin</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/>About Me </a><a class=menu-item href=/publications/>Publications </a><a class=menu-item href=/contact/>Contact </a><a class=menu-item href=/posts/>Blogs </a><a class=menu-item href=/links/>Links </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop><input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Qi Qin">Qi Qin</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/ title>About Me</a><a class=menu-item href=/publications/ title>Publications</a><a class=menu-item href=/contact/ title>Contact</a><a class=menu-item href=/posts/ title>Blogs</a><a class=menu-item href=/links/ title>Links</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">2023 MetaTrust Web3 Security CTF Sui Challenges Writeup</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://leoq7.com title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Qi Qin</a></span>&nbsp;<span class=post-category>included in <a href=/categories/Web3/><i class="far fa-folder fa-fw" aria-hidden=true></i>Web3</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-09-19>2023-09-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1415 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;7 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#preface>Preface</a></li><li><a href=#challenge-1-hello-world>Challenge 1: Hello World</a><ul><li><a href=#target-contract>Target contract</a></li><li><a href=#solution>Solution</a></li></ul></li><li><a href=#challenge-2-friendly-fire>Challenge 2: Friendly Fire</a><ul><li><a href=#target-contract-1>Target contract</a></li><li><a href=#solution-1>Solution</a></li></ul></li><li><a href=#challenge-3-mcchicken>Challenge 3: McChicken</a><ul><li><a href=#target-contract-2>Target contract</a></li><li><a href=#solution-2>Solution</a></li></ul></li><li><a href=#challenge-4-coin-flip>Challenge 4: Coin Flip</a><ul><li><a href=#target-contract-3>Target contract</a></li><li><a href=#solution-3>Solution</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=preface>Preface</h2><p>Last week, I participated solo in the <a href=https://ctf.metatrust.io/ target=_blank rel="noopener noreffer">2023 MetaTrust Web3 Security CTF</a>. In addition to the traditional Solidity challenges, Mysten Labs and OtterSec provided four Sui Move challenges as a separate category. Fortunately, I managed to get two first bloods and two second bloods, placing me first in this specific track. Apart from these four challenges, there was also an intriguing challenge involving Move bytecode reverse engineering. Since I have previously written several related writeups, I won&rsquo;t delve into it here. Interested readers can refer to the excellent writeups by <a href=https://ashirleyshe.github.io/p/metatrust-ctf-writeup-bytesmove/ target=_blank rel="noopener noreffer">ashleyhsu.eth</a> and <a href="https://x.com/lj1nu/status/1702565727658742223?s=20" target=_blank rel="noopener noreffer">jinu.eth</a>.</p><h2 id=challenge-1-hello-world>Challenge 1: Hello World</h2><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Challenge Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>Say hello to Douglas Adam.</p><ul><li>Host: metatrustctf.sui.io</li><li>Port: 31337</li><li>Source: <a href=https://github.com/MetaTrustLabs/ctf/tree/master/hellowWorld/>https://github.com/MetaTrustLabs/ctf/tree/master/hellowWorld/</a></li><li>Score: 10</li></ul></div></div></div><h3 id=target-contract>Target contract</h3><p>As the name suggests, the challenge 1 is a sanity-check to let players get familiar with Sui and the CTF framework.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cm>/* https://github.com/MetaTrustLabs/ctf/blob/master/hellowWorld/framework/src/main.rs#L100-L114 */</span><span class=w>
</span><span class=w></span><span class=c1>// Check Solution
</span><span class=c1></span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>args2</span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>SuiValue</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>arg_ob2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SuiValue</span>::<span class=n>Object</span><span class=p>(</span><span class=n>FakeID</span>::<span class=n>Enumerated</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>));</span><span class=w>
</span><span class=w></span><span class=n>args2</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>arg_ob2</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>ret_val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sui_ctf_framework</span>::<span class=n>call_function</span><span class=p>(</span><span class=w>
</span><span class=w>    </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>adapter</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>chall_addr</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>chall</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=s>&#34;is_owner&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>args2</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=nb>Some</span><span class=p>(</span><span class=s>&#34;challenger&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>()),</span><span class=w>
</span><span class=w></span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;[SERVER] Return value {:#?}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ret_val</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>From the code framework above, we can see that this challenge checks whether the player has successfully solved it by calling the <code>is_owner</code> function to check the <code>status</code> and evaluating the return value.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cm>/* https://github.com/MetaTrustLabs/ctf/blob/master/hellowWorld/framework/chall/sources/hello_world.move#L26-L38 */</span><span class=w>
</span><span class=w></span><span class=c1>// [*] Public functions
</span><span class=c1></span><span class=n>public</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>answer_to_life</span><span class=p>(</span><span class=n>status</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Status</span><span class=p>,</span><span class=w> </span><span class=n>answer</span><span class=w> </span>: <span class=nc>vector</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=c1>// What is the answer to life?
</span><span class=c1></span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>actual</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>x</span><span class=s>&#34;2f0039e93a27221fcf657fb877a1d4f60307106113e885096cb44a461cd0afbf&#34;</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>answer_hash</span>: <span class=nc>vector</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>hash</span>::<span class=n>blake2b256</span><span class=p>(</span><span class=o>&amp;</span><span class=n>answer</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>assert</span><span class=o>!</span><span class=p>(</span><span class=n>actual</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>answer_hash</span><span class=p>,</span><span class=w> </span><span class=n>ERR_INVALID_CODE</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>status</span><span class=p>.</span><span class=n>solved</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>public</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>is_owner</span><span class=p>(</span><span class=n>status</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Status</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>assert</span><span class=o>!</span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=n>solved</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>From the contract source code, it&rsquo;s evident that setting the <code>solved</code> field in <code>status</code> to <code>true</code> requires calling the <code>answer_to_life</code> function. This function demands the user to provide the <code>status</code> and a <code>u8</code> vector called answer. It then hashes the answer using <code>blake2b256</code> and compares it to a predefined hash. If they match, the <code>solved</code> field is set to true.</p><h3 id=solution>Solution</h3><p>This hash is clearly irreversible, but based on the hint in the comments, &ldquo;What is the answer to life?&rdquo; we can deduce that the answer is 42, as found in <em>The Hitchhiker&rsquo;s Guide to the Galaxy</em>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=n>module</span><span class=w> </span><span class=n>solution</span>::<span class=n>hello_world_solution</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>challenge</span>::<span class=n>hello_world</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=n>public</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>solve</span><span class=p>(</span><span class=n>status</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>hello_world</span>::<span class=n>Status</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>answer</span><span class=w> </span>: <span class=nc>vector</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vector</span><span class=p>[</span><span class=mi>52</span><span class=p>,</span><span class=mi>50</span><span class=p>];</span><span class=w> </span><span class=c1>// ascii of &#34;42&#34;
</span><span class=c1></span><span class=w>        </span><span class=n>challenge</span>::<span class=n>hello_world</span>::<span class=n>answer_to_life</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>answer</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><h2 id=challenge-2-friendly-fire>Challenge 2: Friendly Fire</h2><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Challenge Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>Keep your friends close and Enemies Closer.</p><ul><li>Host: metatrustctf.sui.io</li><li>Port: 31338</li><li>Source: <a href=https://github.com/MetaTrustLabs/ctf/tree/master/friendlyFire>https://github.com/MetaTrustLabs/ctf/tree/master/friendlyFire</a></li><li>Score: 50</li></ul></div></div></div><h3 id=target-contract-1>Target contract</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cm>/* https://github.com/MetaTrustLabs/ctf/blob/master/friendlyFire/framework/chall/sources/friendly_fire.move#L27-L40 */</span><span class=w>
</span><span class=w></span><span class=c1>// [*] Public functions
</span><span class=c1></span><span class=n>public</span><span class=p>(</span><span class=n>friend</span><span class=p>)</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>get_flag</span><span class=p>(</span><span class=n>status</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Status</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>status</span><span class=p>.</span><span class=n>solved</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>public</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>is_owner</span><span class=p>(</span><span class=n>status</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Status</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>assert</span><span class=o>!</span><span class=p>(</span><span class=n>status</span><span class=p>.</span><span class=n>solved</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>public</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>prestige</span><span class=p>(</span><span class=n>status</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Status</span><span class=p>,</span><span class=w> </span><span class=n>ctxSender</span>: <span class=nb>String</span><span class=p>,</span><span class=w> </span><span class=n>_ctx</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>TxContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=c1>// let digest: &amp;vector&lt;u8&gt; = tx_context::digest(_ctx);
</span><span class=c1></span><span class=w>    </span><span class=n>assert</span><span class=o>!</span><span class=p>(</span><span class=n>ctxSender</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>std</span>::<span class=n>string</span>::<span class=n>utf8</span><span class=p>(</span><span class=s>b&#34;0x31337690420&#34;</span><span class=p>),</span><span class=w> </span><span class=n>ERR_INVALID_CODE</span><span class=p>)</span><span class=w> </span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=n>get_flag</span><span class=p>(</span><span class=n>status</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>This challenge is similar to the previous one, as it also requires us to set the <code>solved</code> field of <code>status</code> to true. However, in this challenge, the function that can modify the <code>status</code> is <code>get_flag</code>. Due to the restrictions imposed by the <code>friend</code> mechanism, we can only invoke <code>get_flag</code> through the <code>prestige</code> function. To do so, users need to provide <code>ctxSender</code> with the value <code>0x31337690420</code>.</p><h3 id=solution-1>Solution</h3><p>Since the contract doesn&rsquo;t perform any checks on the user input for <code>ctxSender</code> (which seems rather odd), all that is required is to provide the requested value.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=n>module</span><span class=w> </span><span class=n>solution</span>::<span class=n>friendly_fire_solution</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>sui</span>::<span class=n>tx_context</span>::<span class=n>TxContext</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>challenge</span>::<span class=n>friendly_fire</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>public</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>solve</span><span class=p>(</span><span class=n>status</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>friendly_fire</span>::<span class=n>Status</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>TxContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>challenge</span>::<span class=n>friendly_fire</span>::<span class=n>prestige</span><span class=p>(</span><span class=n>status</span><span class=p>,</span><span class=w> </span><span class=n>std</span>::<span class=n>string</span>::<span class=n>utf8</span><span class=p>(</span><span class=s>b&#34;0x31337690420&#34;</span><span class=p>),</span><span class=w> </span><span class=n>ctx</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><h2 id=challenge-3-mcchicken>Challenge 3: McChicken</h2><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Challenge Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>A customer just ordered from the secret menu, but none of the employees know how to cook the secret burgers. Could you please help?</p><ul><li>Host: metatrustctf.sui.io</li><li>Port: 31339</li><li>Source: <a href=https://github.com/MetaTrustLabs/ctf/tree/master/McChicken>https://github.com/MetaTrustLabs/ctf/tree/master/McChicken</a></li><li>Score: 200</li></ul></div></div></div><h3 id=target-contract-2>Target contract</h3><p>This challenge presents an intriguing puzzle where the contract implements functions like <code>place_order</code> and <code>deliver_order</code> to simulate restaurant ordering and serving. A hamburger here can consist of five ingredients: Mayo, Lettuce, Chicken Schnitzel, Cheese, and Bun.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cm>/* https://github.com/MetaTrustLabs/ctf/blob/master/McChicken/framework/chall/sources/mc_chicken.move#L19-L23 */</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>Mayo</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>store</span><span class=p>,</span><span class=w> </span><span class=n>copy</span><span class=p>,</span><span class=w> </span><span class=n>drop</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>calories</span><span class=w> </span>: <span class=kt>u16</span> <span class=p>}</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>Lettuce</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>store</span><span class=p>,</span><span class=w> </span><span class=n>copy</span><span class=p>,</span><span class=w> </span><span class=n>drop</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>calories</span><span class=w> </span>: <span class=kt>u16</span> <span class=p>}</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>ChickenSchnitzel</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>store</span><span class=p>,</span><span class=w> </span><span class=n>copy</span><span class=p>,</span><span class=w> </span><span class=n>drop</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>calories</span><span class=w> </span>: <span class=kt>u16</span> <span class=p>}</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>Cheese</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>store</span><span class=p>,</span><span class=w> </span><span class=n>copy</span><span class=p>,</span><span class=w> </span><span class=n>drop</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>calories</span><span class=w> </span>: <span class=kt>u16</span> <span class=p>}</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>Bun</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>store</span><span class=p>,</span><span class=w> </span><span class=n>copy</span><span class=p>,</span><span class=w> </span><span class=n>drop</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>calories</span><span class=w> </span>: <span class=kt>u16</span> <span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=cm>/* https://github.com/MetaTrustLabs/ctf/blob/master/McChicken/framework/chall/sources/mc_chicken.move#L69-L87 */</span><span class=w>
</span><span class=w></span><span class=n>public</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>get_mayo</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>_chef</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>ChefCapability</span><span class=w> </span><span class=p>)</span><span class=w> </span>: <span class=nc>Mayo</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Mayo</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>calories</span>: <span class=mi>679</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>public</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>get_lettuce</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>_chef</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>ChefCapability</span><span class=w> </span><span class=p>)</span><span class=w> </span>: <span class=nc>Lettuce</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Lettuce</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>calories</span>: <span class=mi>14</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>public</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>get_chicken_schnitzel</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>_chef</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>ChefCapability</span><span class=w> </span><span class=p>)</span><span class=w> </span>: <span class=nc>ChickenSchnitzel</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>ChickenSchnitzel</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>calories</span>: <span class=mi>297</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>public</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>get_cheese</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>_chef</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>ChefCapability</span><span class=w> </span><span class=p>)</span><span class=w> </span>: <span class=nc>Cheese</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Cheese</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>calories</span>: <span class=mi>420</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>public</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>get_bun</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=n>_chef</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>ChefCapability</span><span class=w> </span><span class=p>)</span><span class=w> </span>: <span class=nc>Bun</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Bun</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>calories</span>: <span class=mi>120</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>What makes it interesting is that when a user places an order for a hamburger, they provide a serialized byte sequence representing the hamburger. As chefs responsible for serving the orders, we need to deserialize the customer&rsquo;s order to obtain the recipe for the hamburger they desire.</p><h3 id=solution-2>Solution</h3><p>In the context of BCS encoding, there&rsquo;s an interesting piece of trivia to note: the serialization result for a struct is essentially the serialization result of all its fields combined. In our scenario here, when it comes to serializing a burger, it means concatenating several u16 calorie values that make up its various components together.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cm>/* https://github.com/MetaTrustLabs/ctf/blob/master/McChicken/framework/src/main.rs#L84-L112 */</span><span class=w>
</span><span class=w></span><span class=c1>// Place Order1
</span><span class=c1></span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>order_args</span><span class=w> </span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>SuiValue</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>order_args_1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SuiValue</span>::<span class=n>Object</span><span class=p>(</span><span class=n>FakeID</span>::<span class=n>Enumerated</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>),</span><span class=w> </span><span class=nb>None</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>recepit1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>from</span><span class=p>(</span><span class=w>
</span><span class=w>   </span><span class=p>[</span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0x78</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0x00</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0xa7</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0x02</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0x0e</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0x00</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0x29</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0x01</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0xa4</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0x01</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0x78</span><span class=p>),</span><span class=w>
</span><span class=w>    </span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mh>0x00</span><span class=p>)]);</span><span class=w>
</span><span class=w>    </span><span class=n>order_args</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>order_args_1</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>order_args</span><span class=p>.</span><span class=n>push</span><span class=p>(</span><span class=n>SuiValue</span>::<span class=n>MoveValue</span><span class=p>(</span><span class=n>MoveValue</span>::<span class=n>Vector</span><span class=p>(</span><span class=n>recepit1</span><span class=p>)));</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>ret_val</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sui_ctf_framework</span>::<span class=n>call_function</span><span class=p>(</span><span class=w>
</span><span class=w>    </span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>adapter</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>chall_addr</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=s>&#34;mc_chicken&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=s>&#34;place_order&#34;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>order_args</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=nb>Some</span><span class=p>(</span><span class=s>&#34;customer&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>())</span><span class=w>
</span><span class=w></span><span class=p>).</span><span class=k>await</span><span class=p>;</span><span class=w>
</span><span class=w></span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;[SERVER] Return value {:#?}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>ret_val</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;&#34;</span><span class=p>);</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>Taking Order1 as an example, its serialization result has a length of 12. Therefore, we can attempt to deserialize it into six u16 numbers:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=n>In</span> <span class=p>[</span><span class=mi>1</span><span class=p>]:</span> <span class=kn>import</span> <span class=nn>struct</span>

<span class=n>In</span> <span class=p>[</span><span class=mi>2</span><span class=p>]:</span> <span class=n>struct</span><span class=o>.</span><span class=n>unpack</span><span class=p>(</span><span class=s2>&#34;&lt;6H&#34;</span><span class=p>,</span> <span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x78\x00\xa7\x02\x0e\x00\x29\x01\xa4\x01\x78\x00</span><span class=s2>&#34;</span><span class=p>)</span>
<span class=n>Out</span><span class=p>[</span><span class=mi>2</span><span class=p>]:</span> <span class=p>(</span><span class=mi>120</span><span class=p>,</span> <span class=mi>679</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>297</span><span class=p>,</span> <span class=mi>420</span><span class=p>,</span> <span class=mi>120</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p>Based on the calorie settings for each ingredient in the contract source code, we can deduce the recipe for the first burger as follows: Bun, Mayo, Lettuce, Chicken Schnitzel, Cheese, Bun. Similarly, we can derive the recipe for the second one. Using the <code>ChefCapability</code> permission to &ldquo;create&rdquo; the individual components of the hamburgers, we can represent both hamburgers using two wrapper structs and then proceed with the delivery of the orders.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=n>module</span><span class=w> </span><span class=n>solution</span>::<span class=n>mc_chicken_solution</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=c1>// [*] Import dependencies
</span><span class=c1></span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>sui</span>::<span class=n>tx_context</span>::<span class=n>TxContext</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>challenge</span>::<span class=n>mc_chicken</span><span class=p>;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=k>struct</span> <span class=nc>Order1Burger</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>store</span><span class=p>,</span><span class=w> </span><span class=n>drop</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>bun</span>: <span class=nc>mc_chicken</span>::<span class=n>Bun</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>mayo</span>: <span class=nc>mc_chicken</span>::<span class=n>Mayo</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>lettuce</span>: <span class=nc>mc_chicken</span>::<span class=n>Lettuce</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>chicken_schnitzel</span>: <span class=nc>mc_chicken</span>::<span class=n>ChickenSchnitzel</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>cheese</span>: <span class=nc>mc_chicken</span>::<span class=n>Cheese</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>bun2</span>: <span class=nc>mc_chicken</span>::<span class=n>Bun</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=k>struct</span> <span class=nc>Order2Burger</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>store</span><span class=p>,</span><span class=w> </span><span class=n>drop</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>bun</span>: <span class=nc>mc_chicken</span>::<span class=n>Bun</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>cheese</span>: <span class=nc>mc_chicken</span>::<span class=n>Cheese</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>cheese2</span>: <span class=nc>mc_chicken</span>::<span class=n>Cheese</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>chicken_schnitzel</span>: <span class=nc>mc_chicken</span>::<span class=n>ChickenSchnitzel</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>cheese3</span>: <span class=nc>mc_chicken</span>::<span class=n>Cheese</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>chicken_schnitzel2</span>: <span class=nc>mc_chicken</span>::<span class=n>ChickenSchnitzel</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>cheese4</span>: <span class=nc>mc_chicken</span>::<span class=n>Cheese</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>chicken_schnitzel3</span>: <span class=nc>mc_chicken</span>::<span class=n>ChickenSchnitzel</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>cheese5</span>: <span class=nc>mc_chicken</span>::<span class=n>Cheese</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>cheese6</span>: <span class=nc>mc_chicken</span>::<span class=n>Cheese</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>bun2</span>: <span class=nc>mc_chicken</span>::<span class=n>Bun</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=c1>// [*] Public functions
</span><span class=c1></span><span class=w>    </span><span class=n>public</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>solve</span><span class=p>(</span><span class=n>chef</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>mc_chicken</span>::<span class=n>ChefCapability</span><span class=p>,</span><span class=w> </span><span class=n>order1</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>mc_chicken</span>::<span class=n>Order</span><span class=p>,</span><span class=w> </span><span class=n>order2</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>mc_chicken</span>::<span class=n>Order</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>TxContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>burger1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Order1Burger</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=n>bun</span>: <span class=nc>mc_chicken</span>::<span class=n>get_bun</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>mayo</span>: <span class=nc>mc_chicken</span>::<span class=n>get_mayo</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>lettuce</span>: <span class=nc>mc_chicken</span>::<span class=n>get_lettuce</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>chicken_schnitzel</span>: <span class=nc>mc_chicken</span>::<span class=n>get_chicken_schnitzel</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>cheese</span>: <span class=nc>mc_chicken</span>::<span class=n>get_cheese</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>bun2</span>: <span class=nc>mc_chicken</span>::<span class=n>get_bun</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=p>};</span><span class=w>
</span><span class=w>        </span><span class=n>mc_chicken</span>::<span class=n>deliver_order</span><span class=p>(</span><span class=n>chef</span><span class=p>,</span><span class=w> </span><span class=n>order1</span><span class=p>,</span><span class=w> </span><span class=n>burger1</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>burger2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Order2Burger</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=n>bun</span>: <span class=nc>mc_chicken</span>::<span class=n>get_bun</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>cheese</span>: <span class=nc>mc_chicken</span>::<span class=n>get_cheese</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>cheese2</span>: <span class=nc>mc_chicken</span>::<span class=n>get_cheese</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>chicken_schnitzel</span>: <span class=nc>mc_chicken</span>::<span class=n>get_chicken_schnitzel</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>cheese3</span>: <span class=nc>mc_chicken</span>::<span class=n>get_cheese</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>chicken_schnitzel2</span>: <span class=nc>mc_chicken</span>::<span class=n>get_chicken_schnitzel</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>cheese4</span>: <span class=nc>mc_chicken</span>::<span class=n>get_cheese</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>chicken_schnitzel3</span>: <span class=nc>mc_chicken</span>::<span class=n>get_chicken_schnitzel</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>cheese5</span>: <span class=nc>mc_chicken</span>::<span class=n>get_cheese</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>cheese6</span>: <span class=nc>mc_chicken</span>::<span class=n>get_cheese</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>            </span><span class=n>bun2</span>: <span class=nc>mc_chicken</span>::<span class=n>get_bun</span><span class=p>(</span><span class=n>chef</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=p>};</span><span class=w>
</span><span class=w>        </span><span class=n>mc_chicken</span>::<span class=n>deliver_order</span><span class=p>(</span><span class=n>chef</span><span class=p>,</span><span class=w> </span><span class=n>order2</span><span class=p>,</span><span class=w> </span><span class=n>burger2</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><h2 id=challenge-4-coin-flip>Challenge 4: Coin Flip</h2><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw" aria-hidden=true></i>Challenge Info<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><p>It&rsquo;s all about luck &mldr; they say …</p><ul><li>Host: metatrustctf.sui.io</li><li>Port: 31340</li><li>Source: <a href=https://github.com/MetaTrustLabs/ctf/tree/master/coinFlip>https://github.com/MetaTrustLabs/ctf/tree/master/coinFlip</a></li><li>Score: 200</li></ul></div></div></div><h3 id=target-contract-3>Target contract</h3><p>In this challenge, the author has created a coin flipping game that requires users to consecutively guess correctly 12 times in a row. It&rsquo;s worth noting that the randomness of the coin flips is not provided through VRF (Verifiable Random Function) but is generated using a custom-defined LCG (Linear Congruential Generator) to produce random numbers.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cm>/* https://github.com/MetaTrustLabs/ctf/blob/master/coinFlip/framework/chall/sources/coin_flip.move#L38-L50 */</span><span class=w>
</span><span class=w></span><span class=n>public</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>create_game</span><span class=p>(</span><span class=w> </span><span class=n>stake</span>: <span class=nc>Coin</span><span class=o>&lt;</span><span class=n>SUI</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>randomness</span>: <span class=kt>u64</span><span class=p>,</span><span class=w> </span><span class=n>fee</span>: <span class=kt>u8</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>TxContext</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>game</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Game</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>id</span>: <span class=nc>object</span>::<span class=n>new</span><span class=p>(</span><span class=n>ctx</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>stake</span>: <span class=nc>stake</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>combo</span>: <span class=mi>0</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>fee</span>: <span class=nc>fee</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>player</span>: <span class=nc>RANDOM_ADDRESS</span><span class=p>,</span><span class=w>
</span><span class=w>        </span><span class=n>author</span>: <span class=nc>tx_context</span>::<span class=n>sender</span><span class=p>(</span><span class=n>ctx</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>randomness</span>: <span class=nc>new_generator</span><span class=p>(</span><span class=n>randomness</span><span class=p>),</span><span class=w>
</span><span class=w>        </span><span class=n>solved</span>: <span class=nc>false</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=p>};</span><span class=w>
</span><span class=w>    </span><span class=n>transfer</span>::<span class=n>public_share_object</span><span class=p>(</span><span class=n>game</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=cm>/* https://github.com/MetaTrustLabs/ctf/blob/master/coinFlip/framework/chall/sources/coin_flip.move#L90-L97 */</span><span class=w>
</span><span class=w></span><span class=n>fun</span><span class=w> </span><span class=n>new_generator</span><span class=p>(</span><span class=n>seed</span>: <span class=kt>u64</span><span class=p>)</span>: <span class=nc>Random</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>Random</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>seed</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=n>fun</span><span class=w> </span><span class=n>generate_rand</span><span class=p>(</span><span class=n>r</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Random</span><span class=p>)</span>: <span class=kt>u64</span> <span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>r</span><span class=p>.</span><span class=n>seed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>((((</span><span class=mi>9223372036854775783</span><span class=kt>u128</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>((</span><span class=n>r</span><span class=p>.</span><span class=n>seed</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u128</span><span class=p>))</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>999983</span><span class=p>)</span><span class=w> </span><span class=o>&gt;&gt;</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=mh>0x0000000000000000ffffffffffffffff</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u64</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=n>r</span><span class=p>.</span><span class=n>seed</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><h3 id=solution-3>Solution</h3><p>If we carefully examine the code for creating the game within the framework, we can observe that the seed for the LCG is actually just a u8. Therefore, we can potentially predict the outcome of the coin flips by brute-forcing this seed, with a 1/256 chance of guessing the correct seed.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cm>/* https://github.com/MetaTrustLabs/ctf/blob/master/coinFlip/framework/src/main.rs#L74-L82 */</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>create_args</span><span class=w> </span>: <span class=nb>Vec</span><span class=o>&lt;</span><span class=n>SuiValue</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Vec</span>::<span class=n>new</span><span class=p>();</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=k>mut</span><span class=w> </span><span class=n>rng</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rand</span>::<span class=n>thread_rng</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>random_byte</span>: <span class=kt>u8</span> <span class=o>=</span><span class=w> </span><span class=n>rng</span><span class=p>.</span><span class=n>gen</span><span class=p>();</span><span class=w>
</span><span class=w></span><span class=n>println</span><span class=o>!</span><span class=p>(</span><span class=s>&#34;Random Seed: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>random_byte</span><span class=p>);</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>create_args_1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SuiValue</span>::<span class=n>Object</span><span class=p>(</span><span class=n>FakeID</span>::<span class=n>Enumerated</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>),</span><span class=w> </span><span class=nb>None</span><span class=p>);</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>create_args_2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SuiValue</span>::<span class=n>MoveValue</span><span class=p>(</span><span class=n>MoveValue</span>::<span class=n>U64</span><span class=p>(</span><span class=n>random_byte</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u64</span><span class=p>));</span><span class=w>
</span><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>create_args_3</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SuiValue</span>::<span class=n>MoveValue</span><span class=p>(</span><span class=n>MoveValue</span>::<span class=n>U8</span><span class=p>(</span><span class=mi>10</span><span class=p>));</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>Is there a more elegant way to obtain the seed without resorting to brute-force cracking? The answer is yes. Although Move language restricts us from accessing fields defined in the Foo module within the Bar module under normal circumstances, there&rsquo;s a clever workaround, which involves using the BCS encoding.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=cm>/* https://github.com/MetaTrustLabs/ctf/blob/master/coinFlip/framework/chall/sources/coin_flip.move#L22-L35 */</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>Random</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>drop</span><span class=p>,</span><span class=w> </span><span class=n>store</span><span class=p>,</span><span class=w> </span><span class=n>copy</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>seed</span>: <span class=kt>u64</span>
<span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>struct</span> <span class=nc>Game</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>key</span><span class=p>,</span><span class=w> </span><span class=n>store</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=n>id</span>: <span class=nc>UID</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>stake</span>: <span class=nc>Coin</span><span class=o>&lt;</span><span class=n>SUI</span><span class=o>&gt;</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>combo</span>: <span class=kt>u8</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>fee</span>: <span class=kt>u8</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>player</span>: <span class=nc>address</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>author</span>: <span class=nc>address</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>randomness</span>: <span class=nc>Random</span><span class=p>,</span><span class=w>
</span><span class=w>    </span><span class=n>solved</span><span class=w> </span>: <span class=kt>bool</span><span class=p>,</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div><p>Recalling what we mentioned earlier, BCS encoding only serializes and concatenates the underlying types within a struct. In the case of the <code>Game</code>, after serializing it, if we read the ninth-to-last byte (skipping the 1 byte for <code>solved</code> and the 7 high-order bytes for <code>seed</code>), we will obtain the least significant byte of <code>game.randomness.seed</code>. Once we have this seed, we can use the same LCG as in the challenge to generate random numbers and predict the outcomes, achieving a 100% correct guessing rate.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-rust data-lang=rust><span class=n>module</span><span class=w> </span><span class=n>solution</span>::<span class=n>coin_flip_solution</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=c1>// [*] Import dependencies
</span><span class=c1></span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>sui</span>::<span class=n>tx_context</span>::<span class=n>TxContext</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>challenge</span>::<span class=n>coin_flip</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>sui</span>::<span class=n>coin</span>::<span class=p>{</span><span class=n>Self</span><span class=p>,</span><span class=w> </span><span class=n>Coin</span><span class=p>};</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>sui</span>::<span class=n>sui</span>::<span class=n>SUI</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>bcs</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>use</span><span class=w> </span><span class=n>std</span>::<span class=n>vector</span><span class=p>;</span><span class=w>
</span><span class=w>    </span><span class=k>struct</span> <span class=nc>Random</span><span class=w> </span><span class=n>has</span><span class=w> </span><span class=n>drop</span><span class=p>,</span><span class=w> </span><span class=n>store</span><span class=p>,</span><span class=w> </span><span class=n>copy</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>seed</span>: <span class=kt>u64</span>
    <span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=c1>// [*] Public functions
</span><span class=c1></span><span class=w>    </span><span class=n>public</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=n>fun</span><span class=w> </span><span class=n>solve</span><span class=p>(</span><span class=n>game</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>coin_flip</span>::<span class=n>Game</span><span class=p>,</span><span class=w> </span><span class=n>balance</span>: <span class=nc>Coin</span><span class=o>&lt;</span><span class=n>SUI</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>TxContext</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>bytes</span>: <span class=nc>vector</span><span class=o>&lt;</span><span class=kt>u8</span><span class=o>&gt;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bcs</span>::<span class=n>to_bytes</span><span class=p>(</span><span class=n>game</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>secret</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>*</span><span class=n>vector</span>::<span class=n>borrow</span><span class=p>(</span><span class=o>&amp;</span><span class=n>bytes</span><span class=p>,</span><span class=w> </span><span class=n>vector</span>::<span class=n>length</span><span class=p>(</span><span class=o>&amp;</span><span class=n>bytes</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>9</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>r</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>new_generator</span><span class=p>((</span><span class=n>secret</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u64</span><span class=p>));</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>round</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>fee</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>coin</span>::<span class=n>split</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>balance</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=n>coin_flip</span>::<span class=n>start_game</span><span class=p>(</span><span class=n>game</span><span class=p>,</span><span class=w> </span><span class=n>fee</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>round</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>11</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>            </span><span class=kd>let</span><span class=w> </span><span class=n>guess</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>generate_rand</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>r</span><span class=p>)</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span><span class=w>            </span><span class=n>round</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>round</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span><span class=w>            </span><span class=n>coin_flip</span>::<span class=n>play_game</span><span class=p>(</span><span class=n>game</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=n>guess</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u8</span><span class=p>),</span><span class=w> </span><span class=n>coin</span>::<span class=n>split</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>balance</span><span class=p>,</span><span class=w> </span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>),</span><span class=w> </span><span class=n>ctx</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=p>};</span><span class=w>
</span><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>guess</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>generate_rand</span><span class=p>(</span><span class=o>&amp;</span><span class=k>mut</span><span class=w> </span><span class=n>r</span><span class=p>)</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span><span class=w>        </span><span class=n>coin_flip</span>::<span class=n>play_game</span><span class=p>(</span><span class=n>game</span><span class=p>,</span><span class=w> </span><span class=p>(</span><span class=n>guess</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u8</span><span class=p>),</span><span class=w> </span><span class=n>balance</span><span class=p>,</span><span class=w> </span><span class=n>ctx</span><span class=p>);</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>fun</span><span class=w> </span><span class=n>new_generator</span><span class=p>(</span><span class=n>seed</span>: <span class=kt>u64</span><span class=p>)</span>: <span class=nc>Random</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>Random</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>seed</span><span class=w> </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=n>fun</span><span class=w> </span><span class=n>generate_rand</span><span class=p>(</span><span class=n>r</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>Random</span><span class=p>)</span>: <span class=kt>u64</span> <span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=n>r</span><span class=p>.</span><span class=n>seed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>((((</span><span class=mi>9223372036854775783</span><span class=kt>u128</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=p>((</span><span class=n>r</span><span class=p>.</span><span class=n>seed</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u128</span><span class=p>))</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>999983</span><span class=p>)</span><span class=w> </span><span class=o>&gt;&gt;</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=o>&amp;</span><span class=w> </span><span class=mh>0x0000000000000000ffffffffffffffff</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=kt>u64</span><span class=p>);</span><span class=w>
</span><span class=w>        </span><span class=n>r</span><span class=p>.</span><span class=n>seed</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></td></tr></table></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-09-19</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://leoq7.com/2023/09/MetaTrust-CTF-Sui/ data-title="2023 MetaTrust Web3 Security CTF Sui Challenges Writeup" data-via=LeoQ7_ data-hashtags=Web3,CTF,Move><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://leoq7.com/2023/09/MetaTrust-CTF-Sui/ data-hashtag=Web3><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://leoq7.com/2023/09/MetaTrust-CTF-Sui/ data-title="2023 MetaTrust Web3 Security CTF Sui Challenges Writeup"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://leoq7.com/2023/09/MetaTrust-CTF-Sui/ data-title="2023 MetaTrust Web3 Security CTF Sui Challenges Writeup"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@6.20.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://leoq7.com/2023/09/MetaTrust-CTF-Sui/ data-title="2023 MetaTrust Web3 Security CTF Sui Challenges Writeup"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/Web3/>Web3</a>,&nbsp;<a href=/tags/CTF/>CTF</a>,&nbsp;<a href=/tags/Move/>Move</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2023/02/PBCTF-Move-VM/ class=prev rel=prev title="PBCTF 2023 Move VM Writeup"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>PBCTF 2023 Move VM Writeup</a></div></div><div id=comments><div id=utterances class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2020 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Qi Qin</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/css/lightgallery-bundle.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.1/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js></script><script type=text/javascript>window.config={code:{maxShownLines:50},comment:{utterances:{darkTheme:"github-dark",issueTerm:"og:title",label:"",lightTheme:"github-light",repo:"LeoQ7/LeoQ7-comments"}},lightgallery:!0,math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>